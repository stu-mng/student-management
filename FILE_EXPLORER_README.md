# 檔案總管功能說明

## 功能概述

檔案總管是一個完整的 Google Drive 檔案管理系統，提供以下核心功能：

### 1. 檔案列表與瀏覽
- **依權限瀏覽**：根據用戶角色顯示可訪問的檔案
- **分類顯示**：自動識別並分類不同類型的檔案（文件、圖片、影片等）
- **資料夾導航**：支援進入資料夾、返回上層的完整導航體驗
- **麵包屑導航**：清楚顯示當前位置路徑

### 2. 檔案操作
- **下載功能**：支援 Google Drive 原生檔案下載
- **線上預覽**：支援 Google Drive 線上預覽功能
- **搜尋功能**：快速搜尋特定檔案或內容

### 3. 用戶體驗
- **雙檢視模式**：網格檢視和列表檢視
- **響應式設計**：支援各種螢幕尺寸
- **權限控制**：僅管理員和相關角色可訪問

## 技術實現

### 前端組件
- **檔案總管頁面**：`/app/dashboard/file-explorer/page.tsx`
- **Dashboard 整合**：已添加到管理員功能區塊
- **權限控制**：使用 `RestrictedCard` 組件

### 後端 API
- **Google Drive API**：`/api/drive` 端點
- **檔案列表**：支援資料夾瀏覽和搜尋
- **檔案詳情**：`/api/drive/[fileId]` 端點

### 權限設定
```typescript
allowedRoles: ["admin", "root", "class-teacher", "manager"]
```

## 使用方法

### 1. 訪問檔案總管
- 登入系統後，在 Dashboard 的「管理員功能」區塊中點擊「檔案總管」
- 或直接訪問 `/dashboard/file-explorer`

### 2. 瀏覽檔案
- **網格檢視**：預設檢視模式，適合快速瀏覽
- **列表檢視**：詳細檢視模式，顯示更多檔案資訊
- **資料夾導航**：點擊資料夾圖示進入子資料夾

### 3. 搜尋檔案
- 使用搜尋框輸入關鍵字
- 支援檔案名稱搜尋
- 按 Enter 鍵或點擊搜尋按鈕執行搜尋

### 4. 檔案操作
- **預覽**：點擊「預覽」按鈕在新分頁中開啟檔案
- **下載**：點擊「下載」按鈕下載檔案到本地

## 檔案類型支援

| 檔案類型 | 圖示 | 支援操作 |
|---------|------|----------|
| 資料夾 | 📁 | 進入瀏覽 |
| 文件 | 📄 | 預覽、下載 |
| 試算表 | 📊 | 預覽、下載 |
| 簡報 | 📽️ | 預覽、下載 |
| 圖片 | 🖼️ | 預覽、下載 |
| 影片 | 🎥 | 預覽、下載 |
| 音訊 | 🎵 | 預覽、下載 |
| 壓縮檔 | 📦 | 下載 |

## 注意事項

### 權限要求
- 需要管理員或相關管理權限
- 服務帳戶必須有 Google Drive 讀取權限
- 必須是共用雲端硬碟的成員

### 技術限制
- 目前使用 `any` 類型來避免 Google APIs 的複雜類型約束
- 建議在生產環境中配置適當的 TypeScript 規則
- 檔案大小限制遵循 Google Drive API 規範

### 效能考量
- 預設分頁大小：100 個檔案
- 支援大型資料夾瀏覽
- 搜尋結果限制在合理範圍內

## 未來改進

1. **進階搜尋**：支援檔案內容搜尋
2. **批量操作**：支援多檔案選擇和操作
3. **檔案上傳**：支援新檔案上傳到 Google Drive
4. **版本控制**：支援檔案版本管理
5. **協作功能**：支援檔案分享和權限管理

## 故障排除

### 常見問題

**Q: 無法載入檔案列表**
A: 檢查 Google Drive API 設定和服務帳戶權限

**Q: 檔案預覽無法開啟**
A: 確認檔案有 `webViewLink` 屬性，某些檔案類型可能不支援預覽

**Q: 權限不足錯誤**
A: 確認用戶角色包含在 `allowedRoles` 中

### 日誌檢查
- 檢查瀏覽器開發者工具的控制台
- 檢查後端 API 日誌
- 確認環境變數設定正確

## 相關文件

- [Google Drive API 設定](../GOOGLE_DRIVE_SETUP.md)
- [Dashboard 功能說明](../app/dashboard/README.md)
- [權限系統說明](../components/restricted-card/README.md)
